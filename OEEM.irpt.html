<!DOCTYPE html>
<html>
<head>
</head>
<title>RTS OEEM</title>
<script id="sap-ui-bootstrap" src="/sapui5/resources/sap-ui-core.js"
	data-sap-ui-theme="sap_bluecrystal"
	data-sap-ui-libs="sap.ui.core,sap.ui.commons,sap.ui.table,sap.m"
	data-sap-ui-language="en">
	
</script>


<script type="text/javascript" src="Common/js/default.js"></script> 


	<script src="highmaps.js"></script>
	<script src="data.js"></script>
	<script src="drilldown.js"></script>
	<script src="ShopFloor.js"></script>


<script>
	var _userNAME = "unknow";
	// ******************************************************************************************************************************************************************
	function init() {
		_userNAME = document.getElementById("user_name").value;
		var myRoles = document.getElementById("user_roles").value;
		var role2Access = "OEEM_" + document.getElementById("user_role").value;
		// alert(role2Access);
		if (myRoles.indexOf(role2Access) < 0) {
			window.location.assign("security.irpt");
			return true;
		}

		var roleString = document.getElementById("user_role").value;
		var roleArray = roleString.split("_");
		level2Access = roleArray[0];
		plant2Access = roleArray[1];
		new sap.ui.commons.ApplicationHeader({
			logoSrc : "RTS.png",
			logoText : " Overall Equipment Effectiveness on SAP MII",
			displayLogoff : true,
			userName : _userNAME,
			displayWelcome : true,
		}).placeAt("header");

		//Function to handle the select event of the items

		// 		var MenuSelect = function(oEvent) {
		// 			alert(oEvent.getParameter("item").getId());
		// 		};
		MenuDef();
		// Create a menu bar instance

		//		oNavigationBar1.placeAt("sample1");

		// 		StopReasons_Table();
		// 		mTable.attachRowSelectionChange(selectStopReasonsTable);
		//FloorMaps_Tree();
		xTree.placeAt("nav");
		//StopReasons_Table();
		//mTable.placeAt("footer");
		// 		oeePanel.placeAt('p111');
		// 		xPage = new sap.ui.core.HTML("pages", {
		// 			content : "<iframe src=\"http://www.oee.com\" style=\"border:none;\" height=\"100%\" width=\"100%\"></iframe>"
		// 		});

		// 		src = "WorkOrders.irpt?ROLE=ADM_ALL&FloorMaps_Index=26"
		// 		xShell_init(xTree, xPage);
		// 		xShell.placeAt("shell");
	}
	// ******************************************************************************************************************************************************************
	var MenuSelect = function(oEvent) {
		itemid = oEvent.getParameter("item").getId();
		//alert(itemid);
		appID = "";
		switch (itemid) {
		// Menu home
		case "Home_Home":
			setTimeout("location.href = '" + "OEEM.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			// Menu Settings 1
			break;
		case "OEE_Dashboard":
			setTimeout("location.href = '" + "DashBoard.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "OEE_Report":
			setTimeout("location.href = '" + "Reports.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "Equipment_Management":
			appID = "MgtHierarchy.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "MgtHierarchy.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "Hierarchy_Levels_Setup":
			appID = "LvlHierarchy.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "LvlHierarchy.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;

		// Menu Settings 2
		case "item1-4-1":
			appID = "MemMapTags.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "MemMapTags.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-4-5":
			appID = "MemMapTrxs.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "MemMapTrxs.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-4-4":
			appID = "TagCommGroups.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "TagCommGroups.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-4-2":
			appID = "TagTypes.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "TagTypes.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-4-3":
			appID = "TagFunctions.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "TagFunctions.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;

		// Menu Settings 3
		case "item1-5-6":
			appID = "Operators.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "Operators.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-5-1":
			appID = "Stations.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "Stations.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-5-2":
			appID = "Printers.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "Printers.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-5-3":
			appID = "PCoServers.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "PCoServers.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-5-4":
			appID = "PCoAgents.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "PCoAgents.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-5-5":
			appID = "SqlServers.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "SqlServers.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;

		// Menu Settings 4
		case "item1-7-1":
			appID = "UnitsOfMeasure.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "UnitsOfMeasure.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-7-2":
			appID = "ProductsMgmt.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "ProductsMgmt.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-7-3":
			appID = "BomMgmt.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "BomMgmt.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;
		case "item1-7-4":
			appID = "RoutingMgmt.irpt?ROLE=" + document.getElementById("user_role").value;
			//setTimeout("location.href = '" + "RoutingMgmt.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
			break;

		// Menu Default
		default:
			// alert("Items \"" + oEvent.getParameter("itemId") + "\" was selected.");
			break;
		}
		if (appID == "") {
			return false;
		}
		//alert(appID);

		//sap.ui.getCore().getUIArea("article").removeContent(xPage);

		if (!locked) {
			locked = true;
			xPage.setContent("<iframe src=\"" + appID + "\" style=\"border:none;\" height=\"1000px\" width=\"100%\"></iframe>");
			xPage.placeAt("article");
		}

	}

	function MenuDef() {

		var oMenuBar = new sap.ui.commons.MenuBar("menuBar", {
			enabled : true,
			width : "100%",
			design : sap.ui.commons.MenuBarDesign.Header,
		});

		var oMenuBarItem0 = new sap.ui.commons.MenuItem("Home", {
			text : "Home",
			enabled : true,
		});
		oMenuBar.addItem(oMenuBarItem0);
		var oMenuButton0 = new sap.ui.commons.Menu("oMenuButton0");
		oMenuBarItem0.setSubmenu(oMenuButton0);
		var oMenuItem01 = new sap.ui.commons.MenuItem("Home_Home", {
			text : "Home",
			enabled : true
		});
		oMenuButton0.addItem(oMenuItem01);
		oMenuItem01.attachSelect(MenuSelect);

		var oMenuBarItem1 = new sap.ui.commons.MenuItem({
			text : "Settings",
			enabled : true,
		});
		oMenuBar.addItem(oMenuBarItem1);
		var oMenuBarItem2 = new sap.ui.commons.MenuItem({
			text : "Dashboards",
			enabled : true,
		});
		oMenuBar.addItem(oMenuBarItem2);
		var oMenuBarItem3 = new sap.ui.commons.MenuItem({
			text : "Reports",
			enabled : true,
		});
		oMenuBar.addItem(oMenuBarItem3);

		var oMenuButton1 = new sap.ui.commons.Menu("oMenuButton1");
		oMenuBarItem1.setSubmenu(oMenuButton1);
		var oMenuItem1 = new sap.ui.commons.MenuItem("Enterprise_Hierarchy", {
			text : "Enterprise Hierarchy",
			enabled : true
		});
		oMenuButton1.addItem(oMenuItem1);
		oMenuItem1.attachSelect(MenuSelect);
		var oMenuItem2 = new sap.ui.commons.MenuItem("Plant_Connectivity", {
			text : "Plant Connectivity",
			enabled : true
		});
		oMenuButton1.addItem(oMenuItem2);
		oMenuItem2.attachSelect(MenuSelect);
		var oMenuItem3 = new sap.ui.commons.MenuItem("Master_Data_Setup", {
			text : "Master Data Setup",
			enabled : true
		});
		oMenuButton1.addItem(oMenuItem3);

		var oMenuButton2 = new sap.ui.commons.Menu("oMenuButton2");
		oMenuBarItem2.setSubmenu(oMenuButton2);
		var oMenuItem21 = new sap.ui.commons.MenuItem("OEE_Dashboard", {
			text : "OEE Dashboard",
			enabled : true
		});
		oMenuButton2.addItem(oMenuItem21);
		oMenuItem21.attachSelect(MenuSelect);
		var oMenuItem22 = new sap.ui.commons.MenuItem("Availability_Dashboard", {
			text : "Availability Dashboard",
			enabled : true
		});
		oMenuButton2.addItem(oMenuItem22);
		oMenuItem22.attachSelect(MenuSelect);
		var oMenuItem23 = new sap.ui.commons.MenuItem("Performance_Dashboard", {
			text : "Performance Dashboard",
			enabled : true
		});
		oMenuButton2.addItem(oMenuItem23);
		oMenuItem23.attachSelect(MenuSelect);

		var oMenuItem24 = new sap.ui.commons.MenuItem("Quality_Dashboardy", {
			text : "Quality Dashboardy",
			enabled : true
		});
		oMenuButton2.addItem(oMenuItem24);
		oMenuItem24.attachSelect(MenuSelect);
		var oMenuItem25 = new sap.ui.commons.MenuItem("Alerts_Dashboard", {
			text : "Alerts Dashboard",
			enabled : true
		});
		oMenuButton2.addItem(oMenuItem25);
		oMenuItem25.attachSelect(MenuSelect);

		var oMenuButton3 = new sap.ui.commons.Menu("oMenuButton3");
		oMenuBarItem3.setSubmenu(oMenuButton3);
		var oMenuItem31 = new sap.ui.commons.MenuItem("OEE_Report", {
			text : "OEE Report",
			enabled : true
		});
		oMenuButton3.addItem(oMenuItem31);
		oMenuItem31.attachSelect(MenuSelect);
		var oMenuItem32 = new sap.ui.commons.MenuItem("Availability_Report", {
			text : "Availability Report",
			enabled : true
		});
		oMenuButton3.addItem(oMenuItem32);
		oMenuItem32.attachSelect(MenuSelect);
		var oMenuItem33 = new sap.ui.commons.MenuItem("Performance_Report", {
			text : "Performance Report",
			enabled : true
		});
		oMenuButton3.addItem(oMenuItem33);
		oMenuItem33.attachSelect(MenuSelect);
		var oMenuItem34 = new sap.ui.commons.MenuItem("Quality_Report", {
			text : "Quality Report",
			enabled : true
		});
		oMenuButton3.addItem(oMenuItem34);
		oMenuItem34.attachSelect(MenuSelect);
		var oMenuItem35 = new sap.ui.commons.MenuItem("Alerts_Report", {
			text : "Alerts Report",
			enabled : true
		});
		oMenuButton3.addItem(oMenuItem35);
		oMenuItem35.attachSelect(MenuSelect);
		var oMenuItem36 = new sap.ui.commons.MenuItem("Connection_Diagnostics", {
			text : "Connection Diagnostics",
			enabled : true
		});
		oMenuButton3.addItem(oMenuItem36);
		oMenuItem36.attachSelect(MenuSelect);

		var oMenu6 = new sap.ui.commons.Menu("menu6");
		oMenuItem1.setSubmenu(oMenu6);
		var oMenuItem61 = new sap.ui.commons.MenuItem("Equipment_Management", {
			text : "Equipment Management"
		});
		oMenu6.addItem(oMenuItem61);
		oMenuItem61.attachSelect(MenuSelect);
		var oMenuItem62 = new sap.ui.commons.MenuItem("Plant_Work_Force", {
			text : "Plant Work Force"
		});
		oMenu6.addItem(oMenuItem62);
		oMenuItem62.attachSelect(MenuSelect);
		var oMenuItem63 = new sap.ui.commons.MenuItem("Plant_Shifts_and_Breaks", {
			text : "Plant Shifts & Breaks"
		});
		oMenu6.addItem(oMenuItem63);
		oMenuItem63.attachSelect(MenuSelect);
		var oMenuItem64 = new sap.ui.commons.MenuItem("Hierarchy_Levels_Setup", {
			text : "Hierarchy Levels Setup"
		});
		oMenu6.addItem(oMenuItem64);
		oMenuItem64.attachSelect(MenuSelect);

		var oMenu5 = new sap.ui.commons.Menu("oMenu5");
		oMenuItem2.setSubmenu(oMenu5);
		var oMenuItem51 = new sap.ui.commons.MenuItem("Plant_Connectivity_Servers", {
			text : "Plant Connectivity Servers"
		});
		oMenu5.addItem(oMenuItem51);
		oMenuItem51.attachSelect(MenuSelect);
		var oMenuItem52 = new sap.ui.commons.MenuItem("Plant_Connectivity_Agents", {
			text : "Plant Connectivity Agents"
		});
		oMenu5.addItem(oMenuItem52);
		oMenuItem52.attachSelect(MenuSelect);
		var oMenuItem53 = new sap.ui.commons.MenuItem("Line_Side_SQL_Servers", {
			text : "Line Side SQL Servers"
		});
		oMenu5.addItem(oMenuItem53);
		oMenuItem53.attachSelect(MenuSelect);
		var oMenuItem54 = new sap.ui.commons.MenuItem("PLC_Tag_List", {
			text : "PLC Tag List"
		});
		oMenu5.addItem(oMenuItem54);
		oMenuItem54.attachSelect(MenuSelect);
		var oMenuItem55 = new sap.ui.commons.MenuItem("PLC_Tag_Groups", {
			text : "PLC Tag Groups"
		});
		oMenu5.addItem(oMenuItem55);
		oMenuItem55.attachSelect(MenuSelect);
		var oMenuItem56 = new sap.ui.commons.MenuItem("PLC_Tag_Types", {
			text : "PLC Tag Types"
		});
		oMenu5.addItem(oMenuItem56);
		oMenuItem56.attachSelect(MenuSelect);
		var oMenuItem57 = new sap.ui.commons.MenuItem("PLC_Tag_Functions", {
			text : "PLC Tag Functions"
		});
		oMenu5.addItem(oMenuItem57);
		oMenuItem57.attachSelect(MenuSelect);

		var oMenu7 = new sap.ui.commons.Menu("Menu7");
		oMenuItem3.setSubmenu(oMenu7);
		var oMenuItem71 = new sap.ui.commons.MenuItem("Products_Management", {
			text : "Products Management"
		});
		oMenu7.addItem(oMenuItem71);
		oMenuItem71.attachSelect(MenuSelect);
		var oMenuItem72 = new sap.ui.commons.MenuItem("Work_Order_Management", {
			text : "Work Order Management"
		});
		oMenu7.addItem(oMenuItem72);
		oMenuItem72.attachSelect(MenuSelect);
		var oMenuItem73 = new sap.ui.commons.MenuItem("Alerts_Management", {
			text : "Alerts Management"
		});
		oMenu7.addItem(oMenuItem73);
		oMenuItem73.attachSelect(MenuSelect);

		oMenuBar.placeAt("menu");

	}

	// ******************************************************************************************************************************************************************
	var mModelXML = new sap.ui.model.xml.XMLModel();
	var mTable = new sap.ui.table.Table({
		//visibleRowCount : 12,
		//firstVisibleRow : 3,
		//visibleRowCountMode : sap.ui.table.VisibleRowCountMode.Interactive,
		firstVisibleRow : 0,
		selectionBehavior : sap.ui.table.SelectionBehavior.Row,
		selectionMode : sap.ui.table.SelectionMode.Single,
		editable : false,
		enableColumnFreeze : false,
		width : "100%",
		columnHeaderVisible : true,
		enableCustomFilter : false,
	//navigationMode : sap.ui.table.NavigationMode.Paginator
	});

	var StopReasons_Data;
	var StopReasons_selectedIndex;

	function StopReasons_Table() { // Bind the table rows to this model
		//load table's data
		P1 = "SELECT *";
		P2 = "FROM MESM_StopReasons";
		P3 = "ORDER BY sortOrder";
		P4 = "";
		url = "/XMII/Illuminator?QueryTemplate=OEEM/QUERIES/get_Table&Param.1=" + P1 + "&Param.2=" + P2 + "&Param.3=" + P3 + "&Param.4=" + P4 + "&Content-Type=text/xml";
		//alert(url);
		getData(url, parseJsonParent);

		function parseJsonParent(jsondata) {
			StopReasons_selectedIndex = -1;
			StopReasons_Data = [];
			for (var i = 0; i < jsondata.length; i++) {
				StopReasons_Data.push({
					recordID : jsondata[i]['recordID'],
					reasonName : jsondata[i]['reasonName'],
					reasonDescr : jsondata[i]['reasonDescr'],
					reasonActive : jsondata[i]['reasonActive'],
					sortOrder : jsondata[i]['sortOrder'],
					catagory : jsondata[i]['catagory'],
					recordID_FloorMaps : jsondata[i]['recordID_FloorMaps'],
					unitName_FloorMaps : jsondata[i]['unitName_FloorMaps'],
					CreatedBy : jsondata[i]['CreatedBy'],
					CreatedOn : jsondata[i]['CreatedOn'],
				});
			}
		}
		alert(StopReasons_Data.length);
		//var timestamp = new Date().getTime();
		// 		url = "/XMII/Illuminator?QueryTemplate=OEEM/QUERIES/get_Table&Param.1=" + P1 + "&Param.2=" + P2 + "&Param.3=" + P3 + "&ts="
		// 				+ (new Date().getTime()) + "&Content-Type=text/xml";
		//alert(url);
		//url = "mock/Get_Missions.xml"; //Mock request

		mModelXML.loadData(url, "", false);
		//alert(mModelXML.getXML());
		//		createColumns
		mTable.setModel(mModelXML);
		mTable.bindRows("/Rowset/Row");
		mTable.setVisibleRowCount(8);
		mTable.addColumn(new sap.ui.table.Column({
			width : "150px",
			label : new sap.ui.commons.Label({
				text : " Name"
			}),
			template : new sap.ui.commons.TextView().bindProperty("text", "reasonName"),
			sortProperty : "reasonName",
			filterProperty : "reasonName",
			resizable : true,
		}));
		mTable.addColumn(new sap.ui.table.Column({
			width : "auto",
			label : new sap.ui.commons.Label({
				text : " Description"
			}),
			template : new sap.ui.commons.TextView().bindProperty("text", "reasonDescr"),
			sortProperty : "reasonDescr",
			filterProperty : "reasonDescr",
			resizable : true,
		}));
		mTable.addColumn(new sap.ui.table.Column({
			width : "150px",
			label : new sap.ui.commons.Label({
				text : " unitName"
			}),
			template : new sap.ui.commons.TextView().bindProperty("text", "unitName_FloorMaps"),
			sortProperty : "unitName_FloorMaps",
			filterProperty : "unitName_FloorMaps",
			resizable : true,
		}));
		mTable.addColumn(new sap.ui.table.Column({
			width : "80px",
			label : new sap.ui.commons.Label({
				text : " unitID"
			}),
			template : new sap.ui.commons.TextView().bindProperty("text", "recordID_FloorMaps"),
			sortProperty : "recordID_FloorMaps",
			filterProperty : "recordID_FloorMaps",
			resizable : true,
		}));
		mTable.addColumn(new sap.ui.table.Column({
			width : "150px",
			label : new sap.ui.commons.Label({
				text : "Catagory"
			}),
			template : new sap.ui.commons.TextView().bindProperty("text", "catagory"),
			sortProperty : "catagory",
			filterProperty : "catagory",
			resizable : true,
		}));

		// 		mTable.addColumn(new sap.ui.table.Column({
		// 			width : "80px",
		// 			label : new sap.ui.commons.Label({
		// 				text : "ModifiedBy"
		// 			}),
		// 			template : new sap.ui.commons.TextView().bindProperty("text", "ModifiedBy"),
		// 			sortProperty : "ModifiedBy",
		// 			filterProperty : "ModifiedBy",
		// 			resizable : true,
		// 		}));
		// 		mTable.addColumn(new sap.ui.table.Column({
		// 			width : "150px",
		// 			label : new sap.ui.commons.Label({
		// 				text : "ModifiedOn"
		// 			}),
		// 			template : new sap.ui.commons.TextView().bindProperty("text", "ModifiedOn"),
		// 			sortProperty : "ModifiedOn",
		// 			filterProperty : "ModifiedOn",
		// 			resizable : true,
		// 		}));
		mTable.addColumn(new sap.ui.table.Column({
			width : "80px",
			label : new sap.ui.commons.Label({
				text : " CreatedBy"
			}),
			template : new sap.ui.commons.TextView().bindProperty("text", "CreatedBy"),
			sortProperty : "CreatedBy",
			filterProperty : "CreatedBy",
			resizable : true,
		}));

		mTable.addColumn(new sap.ui.table.Column({
			width : "150px",
			label : new sap.ui.commons.Label({
				text : "CreatedOn"
			}),
			template : new sap.ui.commons.TextView().bindProperty("text", "CreatedOn"),
			sortProperty : "CreatedOn",
			filterProperty : "CreatedOn",
			resizable : true,
		}));
		mTable.addColumn(new sap.ui.table.Column({
			width : "60px",
			label : new sap.ui.commons.Label({
				text : "Active"
			}),
			template : new sap.ui.commons.CheckBox().bindProperty("checked", "reasonActive", function(s) {
				return s == "1";
			}),
			resizable : true,
			hAlign : "Center",
		}));

		//		sp = document.getElementById("OEEM_content").clientWidth - 200 - 190;
		mTable.setToolbar(new sap.ui.commons.Toolbar({
			height : "50px",
			items : [ new sap.m.Label({
				desig : sap.m.LabelDesign.Bold,
				textAlign : sap.ui.core.TextAlign.Center,
				text : "DOWNTIME REASON DEFs: LINE(A) - WORKCENTER(B) - EQUIPMENT(C)",
				// 				width : "" + (document.getElementById("OEEM_content").clientWidth - 200 - 400) + "px",
				height : "30px",
			}) ],
			rightItems : [ new sap.ui.commons.Button("btn_tbOperations_add", {
				text : "Add",
				width : "80px",
				height : "30px",
				style : "Default",
				icon : "sap-icon://add",
				lite : true,
				press : function() {
					StopReasons_add("", "add a StopReason");
				}
			}).setEnabled(true), new sap.ui.commons.Button("btn_tbOperations_edit", {
				text : "Edit",
				width : "80px",
				height : "30px",
				style : "Default",
				icon : "sap-icon://edit",
				lite : true,
				press : function() {
					StopReasons_edit("", "edit an operation", true);
				}
			}), new sap.ui.commons.Button("btn_tbOperations_delete", {
				text : "Delete",
				width : "80px",
				height : "30px",
				style : "Default",
				icon : "sap-icon://delete",
				lite : true,
				press : function() {
					StopReasons_edit("", "delete a StopReason", false);
				}
			})

			// 			, new sap.ui.commons.MenuButton({
			// 				height : "30px",
			// 				width : "40px",
			// 				//text : "",
			// 				icon : "sap-icon://menu",
			// 				lite : true,
			// 				menu : new sap.ui.unified.Menu({
			// 					title : "Operation",
			// 					enabled : true,
			// 					items : [ new sap.ui.commons.MenuItem("menu_tbOperations_add", {
			// 						text : "Add",
			// 						enabled : true,
			// 					}), new sap.ui.commons.MenuItem("menu_tbOperations_edit", {
			// 						text : "Edit",
			// 						enabled : true,
			// 					}), new sap.ui.commons.MenuItem("menu_tbOperations_delete", {
			// 						text : "Delete",
			// 						enabled : true,
			// 					}) ]
			// 				}),
			// 				itemSelected : function(oEvent) {
			// 					alert("menuOperationMissionitemSelected");
			// 				}
			// 			})
			]
		}));
		// 		var str = location.href;
		// 		mTable.filter(mTable.getColumns()[3], location.href.substring(location.href.indexOf("FloorMaps_Index=") + 16));
	}

	// ******************************************************************************************************************************************************************

	// 	$(function() {
	// 		if (true) {
	// 			return true;
	// 		}
	// 		var seriesOptions = [];
	// 		function createChart() {

	// 			$('#article').highcharts('StockChart', {
	// 				legend : {
	// 					enabled : true,
	// 					align : "center",
	// 					verticalAlign : "top",
	// 					shadow : false,
	// 				},
	// 				rangeSelector : {
	// 					buttons : [ {
	// 						type : 'day',
	// 						count : 1,
	// 						text : '1d'
	// 					}, {
	// 						type : 'week',
	// 						count : 1,
	// 						text : '1w'
	// 					}, {
	// 						type : 'month',
	// 						count : 1,
	// 						text : '1m'
	// 					}, {
	// 						type : 'year',
	// 						count : 1,
	// 						text : '1y'
	// 					}, {
	// 						type : 'all',
	// 						text : 'All'
	// 					} ],
	// 					selected : 2
	// 				},

	// 				yAxis : {
	// 					labels : {
	// 						formatter : function() {
	// 							return (this.value > 0 ? ' + ' : '') + this.value + '%';
	// 						}
	// 					},
	// 					plotLines : [ {
	// 						value : 0,
	// 						width : 2,
	// 						color : 'silver'
	// 					} ]
	// 				},
	// 				tooltip : {
	// 					pointFormat : '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> (%)<br/>',
	// 					valueDecimals : 2,
	// 					split : true
	// 				},
	// 				height : "400px",
	// 				series : seriesOptions
	// 			});
	// 		}
	// 		var dt = 3600 * 1000;
	// 		var mm = (34560000000 / 3600000) | 0;
	// 		var _oee = new Array(mm);
	// 		function loadData(i) {
	// 			var dd = new Array(mm);
	// 			d0 = (new Date().getTime() - 34560000000);

	// 			for (n = 0; n < mm; n++) {

	// 				dd[n] = new Array(2);
	// 				if (n == 0) {
	// 					dd[n][0] = d0;
	// 				} else {
	// 					dd[n][0] = dd[n - 1][0] + dt;
	// 				}
	// 				dd[n][1] = 90 + 10 * Math.random();
	// 				if (i == 0) {
	// 					_oee[n] = new Array(2);
	// 					_oee[n][0] = dd[n][0];
	// 					_oee[n][1] = dd[n][1];
	// 				} else if (i == 1 | i == 2) {
	// 					_oee[n][1] = _oee[n][1] * dd[n][1] / 100;
	// 				}
	// 			}
	// 			return dd;
	// 		}
	// 		seriesOptions[0] = {
	// 			name : "Availability",
	// 			data : loadData(0)
	// 		};
	// 		seriesOptions[1] = {
	// 			name : "Performance",
	// 			data : loadData(1)
	// 		};
	// 		seriesOptions[2] = {
	// 			name : "Quality",
	// 			data : loadData(2)
	// 		};
	// 		seriesOptions[3] = {
	// 			name : "OEE",
	// 			data : _oee
	// 		};
	// 		createChart();

	// 	});
	// ******************************************************************************************************************************************************************
	var FloorMaps_Data1;
	var FloorMaps_Data2;
	var xPage = new sap.ui.core.HTML("pages", {
		content : null,
		afterRendering : function() {
			locked = false;
		}
	});
	var FloorMaps_Index;
	var xTree = new sap.ui.commons.Tree("tree", {
		title : "FloorMaps",
		width : "100%",
		//height : "700px",
		showHeaderIcons : true,
		showHorizontalScrollbar : true,
		showHeader : true,
		select : function(oControlEvent) {
			//s = oControlEvent.getParameters().node.getId();
			//n = oControlEvent.getParameters().node.getId().indexOf("_");
			//s.substring(n+1);
			// 			FloorMaps_Index = parseInt(oControlEvent.getParameters().node.getId().substring(
			// 					oControlEvent.getParameters().node.getId().indexOf("_") + 1));
			// 			mTable.filter(mTable.getColumns()[3], FloorMaps_Data1[FloorMaps_Index]['recordID']);
			//alert(FloorMaps_Data1[FloorMaps_Index]['unitName']);
		}
	});
	// ******************************************************************************************************************************************************************
	var _element;

	// 	function AfterRendering() {

	// 		locked = false;
	// 		//xPage.placeAt(_element);
	// 	}
	var panel = new sap.m.Panel("panel", {
		// 		width : "500px",
		height : "600px",
		expandable : true,
		expanded : true,
	});

	$(function() {
		//xPage.attachAfterRendering(AfterRendering);
		//function FloorMaps_Tree() {
		//alert(document.getElementById("container").clientHeight );
		//		panel.setWidth(parseInt(document.getElementById("container").clientWidth * .45));

		// 	    function changeWidth(){

		// 	    } 

		// 		Param1 = "MESM_FloorMaps";
		// 		Param2 = "idUnitParent";
		// 		getData("/XMII/Illuminator?QueryTemplate=OEEM/QUERIES/get_Table&Param.1=" + Param1 + "&Param.2=" + Param2
		// 				+ "&Content-Type=text/xml", parseJsonParent);
		P1 = "SELECT *";
		P2 = "FROM MESM_FloorMaps";
		P3 = "ORDER BY idUnitParent";
		P4 = "";
		url = "/XMII/Illuminator?QueryTemplate=OEEM/QUERIES/get_Table&Param.1=" + P1 + "&Param.2=" + P2 + "&Param.3=" + P3 + "&Param.4=" + P4 + "&Content-Type=text/xml";
		getData(url, parseJsonParent);
		function parseJsonParent(jsondata) {
			FloorMaps_Data1 = [];
			_Node = new Array(jsondata.length);
			for (var i = 0; i < jsondata.length; i++) {
				FloorMaps_Data1.push({
					unitName : jsondata[i]['unitName'],
					recordID : jsondata[i]['recordID'],
					unitType : jsondata[i]['unitType'],
					idUnitParent : jsondata[i]['idUnitParent'],
					children : 0,
					parent : 0,
				});
				_icon = "";
				// 				if (FloorMaps_Data1[i]['unitType'] == "4") {
				// 					_icon = "sap-icon://world";
				// 				}
				// 				if (FloorMaps_Data1[i]['unitType'] == "6") {
				// 					_icon = "sap-icon://line-chart";
				// 				}
				_Node[i] = new sap.ui.commons.TreeNode("FloorMaps_" + i, {
					text : jsondata[i]['unitName'],
					icon : _icon,
					expanded : true
				});
				xTree.addNode(_Node[i]);
			}

			for (var i = 0; i < jsondata.length - 1; i++) {
				for (var j = i + 1; j < jsondata.length; j++) {
					if (FloorMaps_Data1[j]['idUnitParent'] == FloorMaps_Data1[i]['recordID']) {
						_Node[i].addNode(_Node[j]);
						//children+1
						FloorMaps_Data1[j]['parent'] = 1;
						FloorMaps_Data1[i]['children']++;
					}
				}
			}

			FloorMaps_Data2 = [];
			for (var i = 0; i < jsondata.length; i++) {
				if (FloorMaps_Data1[i]['parent'] == 0) {
					if (FloorMaps_Data1[i]['parent'] == 0) {
						FloorMaps_Data2.push({
							id : FloorMaps_Data1[i]['recordID'],
							name : FloorMaps_Data1[i]['unitName'],
							parent : null,
							value : 1,
						});
					}
				} else {
					FloorMaps_Data2.push({
						id : FloorMaps_Data1[i]['recordID'],
						name : FloorMaps_Data1[i]['unitName'],
						parent : FloorMaps_Data1[i]['idUnitParent'],
						value : 1,
					//color : 'blue'
					});

					if (FloorMaps_Data1[i]['children'] == 0) {

						var Availability = 75 + 25 * Math.random();
						var Performance = 75 + 25 * Math.random();
						var Quality = 75 + 25 * Math.random();
						var OEE = Availability * Performance * Performance / 10000;
						var c = "#0F487F";

						if (OEE < 55) {
							c = "#A0D9FF";
						} else if (OEE >= 55 && OEE < 65) {
							c = "#7CB5EC";
						} else if (OEE >= 65 && OEE < 75) {
							c = "#5891C8";
						} else if (OEE >= 75 && OEE < 85) {
							c = "#346DA4";
						}
						FloorMaps_Data2.push({
							name : "Availability",
							parent : FloorMaps_Data1[i]['recordID'],
							value : Availability,
							color : c
						//color : 'blue'
						});
						FloorMaps_Data2.push({
							name : "Performance",
							parent : FloorMaps_Data1[i]['recordID'],
							value : Performance,
							color : c
						});
						FloorMaps_Data2.push({
							name : "Quality",
							parent : FloorMaps_Data1[i]['recordID'],
							value : Quality,
							color : c
						});

						FloorMaps_Data2.push({
							name : "OEE",
							parent : FloorMaps_Data1[i]['recordID'],
							value : OEE,
							color : c
						});
					}

				}

			}

		}

		/////////////////////////////////////////////////////////////////////
		//panel.setWidth(parseInt(document.getElementById("container").clientWidth * .55) + 'px');
		windowHeigth = $(window).height();
		//alert(((windowHeigth - 100) * .6) | 0);
		//panel.placeAt("article");
		// 		var e1 = document.getElementById("article");
		// 		e1.style.width = '300px';
		// 		e1.style.heigth = '600px';

		var tt = 0;
		nWorkCenters = 5;
		var mapLevel1 = new Array(nWorkCenters + 1);
		var mapLevel1Refresh = new Date().getTime(), mapLevel1Cycle = 5 * 1000, mapLeve11Detail = false, mapLeve11DetailRefresh = new Date().getTime(), mapLevel1DetailCycle = 2 * 1000;
		var mapLevel2, mapLevelDetailCycle = 1 * 1000, mapLevel2Refresh = new Date().getTime(), mapLevel2Cycle = 1 * 1000;
		var drilling = false;
		mapLevel1[0] = Highcharts.geojson(Highcharts.maps['ShopFloor']);
		// Some responsiveness

		$.each(mapLevel1[0], function(i) {
			this.drilldown = this.properties['hc-key'];
			this.value = randomBogusData(20, 80); // random bogus data
		});

		var chart1 = new Highcharts.Map('article', {
			chart : {
				events : {
					drilldown : function(e) {

						drilling = true;
						//alert(e.point.drilldown);
						if (!e.seriesOptions) {
							var chart = this, mapKey = e.point.drilldown;

							// Handle error, the timeout is cleared on success
							fail = setTimeout(function() {
								if (!Highcharts.maps[mapKey]) {
									chart.showLoading('<i class="icon-frown"></i> Failed loading ' + e.point.name);

									fail = setTimeout(function() {
										chart.hideLoading();
									}, 1000);
								}
							}, 3000);
							//alert(mapKey);
							// Show the spinner
							chart.showLoading('<i class="icon-spinner icon-spin icon-3x"></i>'); // Font Awesome spinner
							// Load the drilldown map
							// 						var _name;
							$.getScript(mapKey + '.js', function() {
								mapLevel2 = Highcharts.geojson(Highcharts.maps[mapKey]);
								// 							_name = new Array(dataMap.length);
								// Set a non-random bogus value

								$.each(mapLevel2, function(i) {
									this.value = randomBogusData(20, 80);//random bogus data
								});
								//subMapName = e.point.name;
								//subMapLabel = '{point.name}';
								//subMapLabel
								// Hide loading and add series
								chart.hideLoading();
								clearTimeout(fail);
								//Objectpoint = e.point;
								chart.addSeriesAsDrilldown(e.point, {
									name : e.point.name,
									data : mapLevel2,
									dataLabels : {
										enabled : true,
										align : 'center',
										verticalAlign : 'middle',
										format : '{point.name}'
									}
								});

							});
						}

						this.setTitle(null, {
							text : e.point.name
						});
					},
					drillup : function() {
						drilling = false;
						// 			if (chart.series.length == 2) {
						// 				chart.series[1].remove(true);
						// 				chart.series[0].show();
						// 				chart.redraw();
						// 			}
						mapLevel1Refresh = new Date().getTime();
						this.setTitle(null, {
							text : 'Shop Floor'
						});

					},
					load : function() {
						// 			var chart = this;

					}
				}
			},

			title : {
				text : 'Total Effective Equipment Performance'
			},
			subtitle : {
				text : 'Shop Floor',
				floating : false,
				align : 'center',
				y : 50,
				style : {
					fontSize : '16px'
				}
			},
			legend : {
				layout : 'vertical',
				align : 'right',
				verticalAlign : 'middle'
			},
			colorAxis : {
				min : 0,
				minColor : '#E6E7E8',
				maxColor : '#005645'
			},
			mapNavigation : {
				enabled : true,
				buttonOptions : {
					verticalAlign : 'bottom'
				}
			},
			plotOptions : {
				series : {
					point : {
						events : {
							click : function() {
								mapLevel1Refresh = new Date().getTime();
							},
							mouseOver : function() {
								//alert('mouseOver');
								mapLevel1Refresh = new Date().getTime();

							},
							mouseOut : function() {
								//alert('mouseOut');
								mapLevel1Refresh = new Date().getTime();

							}
						}
					}
				}
			},
			series : [ {
				data : mapLevel1[0],
				name : 'Shop Floor',
				dataLabels : {
					enabled : true,
					align : 'center',
					verticalAlign : 'middle',
					format : '{point.properties.name}',
				}
			} ],
			drilldown : {
				//series: drilldownSeries,
				activeDataLabelStyle : {
					color : '#FFFFFF',
					textDecoration : 'none',
					textShadow : '0 0 0px #000000'
				},
				drillUpButton : {
					relativeTo : 'spacingBox',
					position : {
						x : 0,
						y : 60
					}
				}
			},

		});

		function randomBogusData(a, b) {
			return parseInt(a + b * Math.random());

		}

		setInterval(function() {

			if (drilling) {
				if (new Date().getTime() - mapLevel2Refresh > mapLevel2Cycle) {
					$.each(mapLevel2, function(i) {
						this.value = randomBogusData(20, 80);
					});
					chart1.series[0].update({
						data : mapLevel2
					}, true);
					mapLevel2Refresh = new Date().getTime();
				}

			} else {
				if ((new Date().getTime() - mapLevel1Refresh) > mapLevel1Cycle) {
					if (!mapLeve11Detail) {
						//alert('mapLeve11Detail');
						// 						for (n = 1; n <= nWorkCenters; n++) {
						$.getScript('WorkCenter1.js', function() {
							mapLevel1[1] = Highcharts.geojson(Highcharts.maps['WorkCenter1']);
							$.each(mapLevel1[1], function(i) {
								this.value = randomBogusData(20, 80);//random bogus data
							});
							chart1.addSeries({
								data : mapLevel1[1]
							});
						});
						$.getScript('WorkCenter2.js', function() {
							mapLevel1[2] = Highcharts.geojson(Highcharts.maps['WorkCenter2']);
							$.each(mapLevel1[2], function(i) {
								this.value = randomBogusData(20, 80);//random bogus data
							});
							chart1.addSeries({
								data : mapLevel1[2]
							});
						});
						$.getScript('WorkCenter3.js', function() {
							mapLevel1[3] = Highcharts.geojson(Highcharts.maps['WorkCenter3']);
							$.each(mapLevel1[3], function(i) {
								this.value = randomBogusData(20, 80);//random bogus data
							});
							chart1.addSeries({
								data : mapLevel1[3]
							});
						});
						$.getScript('WorkCenter4.js', function() {
							mapLevel1[4] = Highcharts.geojson(Highcharts.maps['WorkCenter4']);
							$.each(mapLevel1[4], function(i) {
								this.value = randomBogusData(20, 80);//random bogus data
							});
							chart1.addSeries({
								data : mapLevel1[4]
							});
						});
						$.getScript('WorkCenter5.js', function() {
							mapLevel1[5] = Highcharts.geojson(Highcharts.maps['WorkCenter5']);
							$.each(mapLevel1[5], function(i) {
								this.value = randomBogusData(20, 80);//random bogus data
							});
							chart1.addSeries({
								data : mapLevel1[5]
							});
						});

						mapLeve11Detail = true;
						mapLeve11DetailRefresh = new Date().getTime();
						//chart1.redraw();
					} else {
						if (new Date().getTime() - mapLeve11DetailRefresh > mapLevel1DetailCycle) {
							for (n = 1; n <= nWorkCenters; n++) {
								$.each(mapLevel1[n], function(i) {
									this.value = randomBogusData(20, 80);
								});
								chart1.series[n].update({
									data : mapLevel1[n]
								}, true);
							}
							mapLeve11DetailRefresh = new Date().getTime();
						}
					}
					//chart1.redraw();
				} else {
					if (mapLeve11Detail) {
						for (n = nWorkCenters; n > 0; n--) {
							chart1.series[n].remove(true);
						}

						mapLeve11Detail = false;
						//chart1.redraw();
					}
				}
			}
		}, 300);

	});
</script>
<body onLoad="init()">

	<input id="user_roles" type="hidden" value="{IllumLoginRoles}"
		style="display: block; width: 1000px;" readonly />
	<input id="user_role" type="hidden" value="{ROLE}"
		style="display: block; width: 1000px;" readonly />
	<input id="user_name" type="hidden" value="{IllumLoginName}"
		style="display: block; width: 1000px;" readonly />
	<input id="user_height" type="hidden" value="{HEIGHT}"
		style="display: block; width: 100px;" readonly />
	<input id="user_address" type="hidden" value="{Machine}"
		style="display: block; width: 1000px;" readonly />

	<div id="container" class="container">
		<header id="header"></header>
		<menu id="menu"></menu>
		<nav id="nav"></nav>
		<article id="article">
			<div id="p1"></div>
			<div id="p2"></div>
		</article>
		<footer id="footer"></footer>
	</div>
</body>
<style>
div.container {
	/* 	border: 1px solid gray; */
	/* 	margin: 0 auto; */
	margin: 0em auto;
	min-width: 1000px;
	width: 100%;
	/* 	margin-top: 100px; */
	/* 	margin-bottom: 100px; */
	/* 	margin-right: 100px; */
	/* 	margin-left: 100px; */
	position: relative;
}

header {
	width: 100%;
}

nav {
	float: left;
	/* 	min-width: 100px; */
	width: 20%;
	margin: 0px 0px 0px 10%;
	/* 	padding: 1em; */
}

nav ul {
	list-style-type: none;
	padding: 0;
}

nav ul a {
	text-decoration: none;
}

article {
	margin-left: 35%;
	width: 60%;
	height: 600px;
	/* 	border-left: 1px solid gray; */
	/* 	padding: 0em; */
	/* 	margin: 0px 10%; */
	/* 	overflow: hidden; */
}

footer {
	/* 	margin-left: 30%; */
	/* 	border-left: 1px solid gray; */
	padding: 1em;
	/* 	overflow: hidden; */
}


</style>



</html>

