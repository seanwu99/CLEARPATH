<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>CT MODULE</title>
    <style>
        body {
            /*background-image: url("Common/img/logo.png");*/
            background-size: 180px;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: right 40px top 30px;
            font-family: Arial;
        }

        #app_header {
            padding: 10px;
            padding-left: 40px;
            padding-top: 15px;
            padding-bottom: 0px;
            height: 80px;
            width: 400px;
            text-align: center;
        }

        #app_title {
            width: 400px;
            text-align: center;
            font-family: "Arial Black", Arial, Helvetica, sans-serif;
            font-size: 32px;
            color: #007dc0;
            /*margin-bottom;*/
            /*20px;*/
        }

        #app_menu {
            width: 400px;
            text-align: center;
            font-family: Arial, Helvetica, sans-serif;
        }

        #page_title {
            width: 400px;
            text-align: center;
            font-family: "Arial Black", Arial, Helvetica, sans-serif;
            font-size: 28px;
            color: #cfcfcf;
        }

        #p1 {
            /*padding: 30px;*/
            padding-top: 30px;
        }

        #mesm_content {
            /*padding: 30px;*/
            /*padding-top: 40px;*/
        }

        #__button0, #__button1, #__button2 {
            margin-top: 10px;
            margin-left: 5px;
            margin-right: 5px;
        }

        #MatrixT, #MatrixB {
            margin: 10px auto;
        }

        #__cell2, #__cell3, #__cell4, #__cell5, #__cell6 {
            text-align: center;
        }

        #__cell0 {
            text-align: right;
        }

        #PlantsList {
            margin-left: 20px;
        }
    </style>

    <script id="sap-ui-bootstrap"
            src="/sapui5/resources/sap-ui-core.js"
            data-sap-ui-theme="sap_goldreflection"
            data-sap-ui-libs="sap.ui.core,sap.ui.commons,sap.ui.table,sap.ui.ux3"
            data-sap-ui-language="en">
    </script>

    <script src="Common/js/default.js"></script>
    <script src="Common/library/Highcharts/highmaps.src.js"></script>
    <script src="Common/library/Highcharts/highcharts.src.js"></script>
    <script src="Common/library/Highcharts/modules/data.js"></script>
    <script src="Common/library/Highcharts/modules/drilldown.js"></script>
    <script src="Common/library/Highcharts/modules/exporting.js"></script>

    <script type="text/javascript" id="app-init">
        // ******************************************************************************************************************************************************************
        // Get Core SAP UI5
        var oCore = sap.ui.getCore();
        // Initialize screen
        var nrRows = 7;
        var selectedIndex = -1;
        // ******************************************************************************************************************************************************************
        // initialize access
        var level2Access = "";
        var plant2Access = "";
        // Initialize screen
        var selectedPlant = 0;
        var recordID = "";
        // ****************************************************************************************************************************************************
        function roleSecurity() {
            var myRoles = document.getElementById("user_roles").value;
            var role2Access = "MESM_" + document.getElementById("user_role").value;
            // alert(role2Access);
            if (myRoles.indexOf(role2Access) < 0) {
                window.location.assign("security.irpt");
            } else {
                var roleString = document.getElementById("user_role").value;
                var roleArray = roleString.split("_");
                level2Access = roleArray[0];
                // alert("level : " + level2Access);
                plant2Access = roleArray[1];
//                alert("plant : " + plant2Access);
                updatePlants(plant2Access);
                createTableConnDiagnostics();
                document.getElementById("page_title").innerHTML = role2Access;

                // enable homepage
                oCore.byId("item3-0-3").setEnabled(true);
                // show menus
                oMenuButton1.placeAt("app_menu");
                oMenuButton2.placeAt("app_menu");
                oMenuButton3.placeAt("app_menu");

                var role_ADM = "MESM_ADM_" + plant2Access;
                var role_ENG = "MESM_ENG_" + plant2Access;
                var role_SUP = "MESM_SUP_" + plant2Access;
                var role_OPS = "MESM_OPS_" + plant2Access;

                switch (role2Access) {
                    case "MESM_ADM_ALL":

                        // enable Cfg Hierarchy
                        oCore.byId("item1-0-1").setEnabled(true);
                        // enable Cfg Memory Maps
                        oCore.byId("item1-0-3").setEnabled(true);
                        // enable Cfg Connectivity
                        oCore.byId("item1-0-4").setEnabled(true);
                        // enable Master Data
                        oCore.byId("item1-0-5").setEnabled(true);

                        // enable WO Management
                        oCore.byId("item2-0-1").setEnabled(true);
                        // enable Carrier Station Dashboard
                        oCore.byId("item2-0-2").setEnabled(true);
                        // enable Assembly Station Dashboard
                        oCore.byId("item2-0-3").setEnabled(true);

                        // enable Production Status Report
                        oCore.byId("item3-0-1").setEnabled(true);
                        // enable Item Traceability Report
                        oCore.byId("item3-0-2").setEnabled(true);
                        // enable Connector Diagnostics
                        oCore.byId("item3-0-3").setEnabled(true);

                        // enable Cfg Memory Maps
                        oCore.byId("item1-4-1").setEnabled(true);
                        // enable Cfg Tag Types
                        oCore.byId("item1-4-2").setEnabled(true);
                        // enable Cfg Tag Functions
                        oCore.byId("item1-4-3").setEnabled(true);
                        // enable Cfg Tag Groups
                        oCore.byId("item1-4-4").setEnabled(true);
                        // enable Cfg Memory Map Transactions
                        oCore.byId("item1-4-5").setEnabled(true);

                        // enable Cfg Shop Floor Computers
                        oCore.byId("item1-5-1").setEnabled(true);
                        // enable Cfg Shop Floor Printers
                        oCore.byId("item1-5-2").setEnabled(true);
                        // enable Cfg PCo Servers
                        oCore.byId("item1-5-3").setEnabled(true);
                        // enable Cfg PCo Agents
                        oCore.byId("item1-5-4").setEnabled(true);
                        // enable Cfg Sql Servers
                        oCore.byId("item1-5-5").setEnabled(true);
                        // enable Cfg Operators
                        oCore.byId("item1-5-6").setEnabled(true);

                        // enable Equipment Hierarchy
                        oCore.byId("item1-6-1").setEnabled(true);
                        // enable Cfg Hierarchy Levels
                        oCore.byId("item1-6-2").setEnabled(true);

                        // Enable UOM Maintenance
                        oCore.byId("item1-7-1").setEnabled(true);
                        // Enable Product Maintenance
                        oCore.byId("item1-7-2").setEnabled(true);
                        // Enable BOM Maintenance
                        oCore.byId("item1-7-3").setEnabled(true);
                        // Enable Routing Maintenance
                        oCore.byId("item1-7-4").setEnabled(true);

                        // update screen
                        document.getElementById("page_title").innerHTML = "ADM ALL PLANTS";
                        oMatrixT.placeAt('mesm_content');
                        break;
                    case role_ADM:

                        // enable Cfg Hierarchy
                        oCore.byId("item1-0-1").setEnabled(true);
                        // enable Cfg Memory Maps
                        oCore.byId("item1-0-3").setEnabled(true);
                        // enable Cfg Connectivity
                        oCore.byId("item1-0-4").setEnabled(true);
                        // enable Master Data
                        oCore.byId("item1-0-5").setEnabled(true);

                        // enable WO Management
                        oCore.byId("item2-0-1").setEnabled(true);
                        // enable Carrier Station Dashboard
                        oCore.byId("item2-0-2").setEnabled(true);
                        // enable Assembly Station Dashboard
                        oCore.byId("item2-0-3").setEnabled(true);

                        // enable Production Status Report
                        oCore.byId("item3-0-1").setEnabled(true);
                        // enable Item Traceability Report
                        oCore.byId("item3-0-2").setEnabled(true);
                        // enable Connector Diagnostics
                        oCore.byId("item3-0-3").setEnabled(true);

                        // enable Cfg Memory Maps
                        oCore.byId("item1-4-1").setEnabled(true);
                        // enable Cfg Tag Types
                        oCore.byId("item1-4-2").setEnabled(true);
                        // enable Cfg Tag Functions
                        oCore.byId("item1-4-3").setEnabled(true);
                        // enable Cfg Tag Groups
                        oCore.byId("item1-4-4").setEnabled(true);
                        // enable Cfg Memory Map Transactions
                        oCore.byId("item1-4-5").setEnabled(true);

                        // enable Cfg Shop Floor Computers
                        oCore.byId("item1-5-1").setEnabled(true);
                        // enable Cfg Shop Floor Printers
                        oCore.byId("item1-5-2").setEnabled(true);
                        // enable Cfg PCo Servers
                        oCore.byId("item1-5-3").setEnabled(true);
                        // enable Cfg PCo Agents
                        oCore.byId("item1-5-4").setEnabled(true);
                        // enable Cfg Sql Servers
                        oCore.byId("item1-5-5").setEnabled(true);
                        // enable Cfg Operators
                        oCore.byId("item1-5-6").setEnabled(true);

                        // enable Equipment Hierarchy
                        oCore.byId("item1-6-1").setEnabled(true);
                        // enable Cfg Hierarchy Levels
                        oCore.byId("item1-6-2").setEnabled(true);

                        // Enable UOM Maintenance
                        oCore.byId("item1-7-1").setEnabled(true);
                        // Enable Product Maintenance
                        oCore.byId("item1-7-2").setEnabled(true);
                        // Enable BOM Maintenance
                        oCore.byId("item1-7-3").setEnabled(true);
                        // Enable Routing Maintenance
                        oCore.byId("item1-7-4").setEnabled(true);

                        // update screen
                        document.getElementById("page_title").innerHTML = "ADM PLANT " + plant2Access;
                        oMatrixT.placeAt('mesm_content');
                        break;
                    case "MESM_OPS_ALL":

                        // enable WO Management
                        oCore.byId("item2-0-1").setEnabled(true);
                        // enable Carrier Station Dashboard
                        oCore.byId("item2-0-2").setEnabled(true);
                        // enable Assembly Station Dashboard
                        oCore.byId("item2-0-3").setEnabled(true);

                        // enable Production Status Report
                        oCore.byId("item3-0-1").setEnabled(true);
                        // enable Item Traceability Report
                        oCore.byId("item3-0-2").setEnabled(true);
                        // enable Connector Diagnostics
                        oCore.byId("item3-0-3").setEnabled(true);

                        document.getElementById("page_title").innerHTML = "OPS ALL PLANTS";
                        oMatrixT.placeAt('mesm_content');
                        break;
                    case role_OPS:

                        // enable WO Management
                        oCore.byId("item2-0-1").setEnabled(true);
                        // enable Carrier Station Dashboard
                        oCore.byId("item2-0-2").setEnabled(true);
                        // enable Assembly Station Dashboard
                        oCore.byId("item2-0-3").setEnabled(true);

                        // enable Production Status Report
                        oCore.byId("item3-0-1").setEnabled(true);
                        // enable Item Traceability Report
                        oCore.byId("item3-0-2").setEnabled(true);
                        // enable Connector Diagnostics
                        oCore.byId("item3-0-3").setEnabled(true);

                        document.getElementById("page_title").innerHTML = "OPS PLANT " + plant2Access;
                        oMatrixT.placeAt('mesm_content');
                        break;
                    default:
                        alert("MES Module Role Unknown: " + role2Access);
                        break;
                }
            }
        }
        // ******************************************************************************************************************************************************************
        var oMenuButton1 = new sap.ui.commons.MenuButton({text: "Settings", icon: "Common/img/map.png"});
        var oMenuButton2 = new sap.ui.commons.MenuButton({text: "Dashboards", icon: "Common/img/cloud.png"});
        var oMenuButton3 = new sap.ui.commons.MenuButton({text: "Reports", icon: "Common/img/list.png"});

        // Create the menu
        var oMenu1 = new sap.ui.commons.Menu("menu1", {ariaDescription: "Application Setup", enabled: true});
        // Create the items and add them to the menu
        var oMenuItem1 = new sap.ui.commons.MenuItem("item1-0-1", {text: "Enterprise Hierarchy", enabled: false});
        oMenu1.addItem(oMenuItem1);
        var oMenuItem2 = new sap.ui.commons.MenuItem("item1-0-2", {text: " ???", enabled: false});
        //oMenu1.addItem(oMenuItem2);
        var oMenuItem3 = new sap.ui.commons.MenuItem("item1-0-3", {text: "MES Memory Maps", enabled: false});
        oMenu1.addItem(oMenuItem3);
        var oMenuItem4 = new sap.ui.commons.MenuItem("item1-0-4", {text: "Plant Connectivity", enabled: false});
        oMenu1.addItem(oMenuItem4);
        var oMenuItem5 = new sap.ui.commons.MenuItem("item1-0-5", {text: "Master Data Setup", enabled: false});
        oMenu1.addItem(oMenuItem5);

        var oMenu4 = new sap.ui.commons.Menu("menu4", {ariaDescription: "Memory Maps Setup", enabled: true});
        oMenuItem3.setSubmenu(oMenu4);
        //Create the items and add them to the sub menu
        var oMenuItem41 = new sap.ui.commons.MenuItem("item1-4-1", {text: "Memory Map Tags", enabled: false});
        oMenu4.addItem(oMenuItem41);
        var oMenuItem45 = new sap.ui.commons.MenuItem("item1-4-5", {text: "Memory Map Transactions", enabled: false});
        oMenu4.addItem(oMenuItem45);
        var oMenuItem44 = new sap.ui.commons.MenuItem("item1-4-4", {text: "PLC Tag Groups", enabled: false});
        oMenu4.addItem(oMenuItem44);
        var oMenuItem42 = new sap.ui.commons.MenuItem("item1-4-2", {text: "PLC Tag Types", enabled: false});
        oMenu4.addItem(oMenuItem42);
        var oMenuItem43 = new sap.ui.commons.MenuItem("item1-4-3", {text: "PLC Tag Functions", enabled: false});
        oMenu4.addItem(oMenuItem43);

        var oMenu5 = new sap.ui.commons.Menu("menu5", {ariaDescription: "Connectivity Setup", enabled: true});
        oMenuItem4.setSubmenu(oMenu5);
        //Create the items and add them to the sub menu
        var oMenuItem56 = new sap.ui.commons.MenuItem("item1-5-6", {text: "Shop Floor Operators", enabled: false});
        oMenu5.addItem(oMenuItem56);
        var oMenuItem51 = new sap.ui.commons.MenuItem("item1-5-1", {text: "Shop Floor Computers", enabled: false});
        oMenu5.addItem(oMenuItem51);
        var oMenuItem52 = new sap.ui.commons.MenuItem("item1-5-2", {text: "Shop Floor Printers", enabled: false});
        oMenu5.addItem(oMenuItem52);
        var oMenuItem53 = new sap.ui.commons.MenuItem("item1-5-3", {
            text: "Plant Connectivity Servers",
            enabled: false
        });
        oMenu5.addItem(oMenuItem53);
        var oMenuItem54 = new sap.ui.commons.MenuItem("item1-5-4", {text: "Plant Connectivity Agents", enabled: false});
        oMenu5.addItem(oMenuItem54);
        var oMenuItem55 = new sap.ui.commons.MenuItem("item1-5-5", {text: "Line Side SQL Servers", enabled: false});
        oMenu5.addItem(oMenuItem55);

        var oMenu6 = new sap.ui.commons.Menu("menu6", {ariaDescription: "Hierarchy Setup", enabled: true});
        oMenuItem1.setSubmenu(oMenu6);
        //Create the items and add them to the sub menu
        var oMenuItem61 = new sap.ui.commons.MenuItem("item1-6-1", {text: "Hierarchy Management", enabled: false});
        oMenu6.addItem(oMenuItem61);
        var oMenuItem62 = new sap.ui.commons.MenuItem("item1-6-2", {text: "Hierarchy Levels Setup", enabled: false});
        oMenu6.addItem(oMenuItem62);

        var oMenu7 = new sap.ui.commons.Menu("menu7", {ariaDescription: "Master Data", enabled: true});
        oMenuItem5.setSubmenu(oMenu7);
        //Create the items and add them to the sub menu
        var oMenuItem71 = new sap.ui.commons.MenuItem("item1-7-1", {text: "Units Of Measure", enabled: false});
        oMenu7.addItem(oMenuItem71);
        var oMenuItem72 = new sap.ui.commons.MenuItem("item1-7-2", {text: "Products Management", enabled: false});
        oMenu7.addItem(oMenuItem72);
        var oMenuItem73 = new sap.ui.commons.MenuItem("item1-7-3", {text: "Bills of Materials", enabled: false});
        oMenu7.addItem(oMenuItem73);
        var oMenuItem74 = new sap.ui.commons.MenuItem("item1-7-4", {text: "Products Routing", enabled: false});
        oMenu7.addItem(oMenuItem74);

        // Create the menu
        var oMenu2 = new sap.ui.commons.Menu("menu2", {ariaDescription: "User Dashboards"});
        // Create the items and add them to the menu
        var oMenuItem21 = new sap.ui.commons.MenuItem("item2-0-1", {text: "Work Order Management", enabled: false});
        oMenu2.addItem(oMenuItem21);
        var oMenuItem22 = new sap.ui.commons.MenuItem("item2-0-2", {text: "Carrier Station Dashboard", enabled: false});
        oMenu2.addItem(oMenuItem22);
        var oMenuItem23 = new sap.ui.commons.MenuItem("item2-0-3", {
            text: "Assembly Station Dashboard",
            enabled: false
        });
        oMenu2.addItem(oMenuItem23);

        // Create the menu
        var oMenu3 = new sap.ui.commons.Menu("menu3", {ariaDescription: "User Reports", enabled: true});
        // Create the items and add them to the menu
        var oMenuItem31 = new sap.ui.commons.MenuItem("item3-0-1", {text: "Production Status Report", enabled: false});
        oMenu3.addItem(oMenuItem31);
        var oMenuItem32 = new sap.ui.commons.MenuItem("item3-0-2", {text: "Item Traceability Report", enabled: false});
        oMenu3.addItem(oMenuItem32);
        var oMenuItem33 = new sap.ui.commons.MenuItem("item3-0-3", {text: "Connector Diagnostics", enabled: false});
        oMenu3.addItem(oMenuItem33);

        //Attach the Menu to the MenuButton
        oMenuButton1.setMenu(oMenu1);
        oMenuButton2.setMenu(oMenu2);
        oMenuButton3.setMenu(oMenu3);

        //Attach an event to raise an alert when an item is selected (Button 1)
        oMenuButton1.attachItemSelected(function (oEvent) {
            switch (oEvent.getParameter("itemId")) {
                // Menu Settings 1
                case "item1-6-1":
                    setTimeout("location.href = '" + "MgtHierarchy.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-6-2":
                    setTimeout("location.href = '" + "LvlHierarchy.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;

                // Menu Settings 2
                case "item1-4-1":
                    setTimeout("location.href = '" + "MemMapTags.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-4-5":
                    setTimeout("location.href = '" + "MemMapTrxs.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-4-4":
                    setTimeout("location.href = '" + "TagCommGroups.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-4-2":
                    setTimeout("location.href = '" + "TagTypes.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-4-3":
                    setTimeout("location.href = '" + "TagFunctions.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;

                // Menu Settings 3
                case "item1-5-6":
                    setTimeout("location.href = '" + "Operators.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-5-1":
                    setTimeout("location.href = '" + "Stations.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-5-2":
                    setTimeout("location.href = '" + "Printers.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-5-3":
                    setTimeout("location.href = '" + "PCoServers.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-5-4":
                    setTimeout("location.href = '" + "PCoAgents.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-5-5":
                    setTimeout("location.href = '" + "SqlServers.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;

                // Menu Settings 4
                case "item1-7-1":
                    setTimeout("location.href = '" + "UnitsOfMeasure.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-7-2":
                    setTimeout("location.href = '" + "ProductsMgmt.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-7-3":
                    setTimeout("location.href = '" + "BomMgmt.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item1-7-4":
                    setTimeout("location.href = '" + "RoutingMgmt.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;

                // Menu Default
                default:
                    // alert("Items \"" + oEvent.getParameter("itemId") + "\" was selected.");
                    break;
            }
        });

        //Attach an event to raise an alert when an item is selected. (Button 2)
        oMenuButton2.attachItemSelected(function (oEvent) {
            switch (oEvent.getParameter("itemId")) {
                case "item2-0-1":
                    setTimeout("location.href = '" + "WorkOrders.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item2-0-2":
                    setTimeout("location.href = '" + "CarrierDashboard.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item2-0-3":
                    setTimeout("location.href = '" + "AssemblyDashboard.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                default:
                    // alert("Items \"" + oEvent.getParameter("itemId") + "\" was selected.");
                    break;
            }
        });

        //Attach an event to raise an alert when an item is selected. (Button 3)
        oMenuButton3.attachItemSelected(function (oEvent) {
            switch (oEvent.getParameter("itemId")) {
                // Menu Reports
                case "item3-0-1":
                    setTimeout("location.href = '" + "ProductionStatus.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item3-0-2":
                    setTimeout("location.href = '" + "ItemTraceability.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                case "item3-0-3":
                    setTimeout("location.href = '" + "MESM.irpt?ROLE=" + document.getElementById("user_role").value + "'", 0);
                    break;
                default:
                    //alert("Items \"" + oEvent.getParameter("itemId") + "\" was selected.");
                    break;
            }
        });
        // ****************************************************************************************************************************************************
        var oMatrixT = new sap.ui.commons.layout.MatrixLayout({
            id: 'MatrixT',
            layoutFixed: true,
            width: '1200px',
            columns: 1,
            widths: ['1200px']
        });

        var oLabelPlants = new sap.ui.commons.Label({
            id: 'L-Plants',
            visible: true,
            text: 'SELECTED PLANT '
        });

        var oDropdownBoxPlants = new sap.ui.commons.DropdownBox({
            id: "PlantsList",
            tooltip: 'Active Plants',
            editable: true,
            width: '230px',
            change: function (oEvent) {
                //alert(oEvent.oSource.getSelectedItemId());
                var endplant = oEvent.oSource.getSelectedItemId();
                var result = endplant.substring(6, endplant.length);
                selectedPlant = result;
                // alert(result);
                updateTableConnDiagnostics();
            }
        });

        var oLayout = new sap.ui.layout.HorizontalLayout("LayoutPlants", {
            content: [oLabelPlants, oDropdownBoxPlants]
        });

        oMatrixT.createRow(oLayout);
        // ****************************************************************************************************************************************************
        function createTableConnDiagnostics() {
            // Bind the table rows to this model
            var timestamp = new Date().getTime();
            oModel.loadData("/XMII/Illuminator?QueryTemplate=MESM/DIAGNOSTICS/QUERIES/get_ConnDiag&Param.1=" + oDropdownBoxPlants.getSelectedKey() + "&ts=" + timestamp + "&Content-Type=text/xml", "", false);
            //alert(oModel.getXML());
            createColumnsConnDiagnostics();
            oTable.setModel(oModel);
            oTable.bindRows("/Rowset/Row");
        }
        ;

        // ****************************************************************************************************************************************************
        function updateTableConnDiagnostics() {
            cc(oDropdownBoxPlants.getSelectedKey());
            oTable.clearSelection();
            var timestamp = new Date().getTime();
            oModel.loadData("/XMII/Illuminator?QueryTemplate=MESM/DIAGNOSTICS/QUERIES/get_ConnDiag&Param.1=" + oDropdownBoxPlants.getSelectedKey() + "&ts=" + timestamp + "&Content-Type=text/xml", "", false);
            oTable.getModel().refresh(true);
        }
        ;
        // ****************************************************************************************************************************************************
        function createColumnsConnDiagnostics() {
            //Define the columns and the control templates to be used
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "WORK CENTER NAME.."}),
                template: new sap.ui.commons.TextView().bindProperty("text", "unitName"),
                sortProperty: "unitName",
                filterProperty: "unitName",
                width: "150px"
            }));
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "SRV STATUS"}),
                template: new sap.ui.commons.Image().bindProperty("src", "stats"),
                width: "75px",
                hAlign: "Center"
            }));
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "PCO STATUS"}),
                template: new sap.ui.commons.Image().bindProperty("src", "agentStats"),
                width: "75px",
                hAlign: "Center"
            }));
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "OPC STATUS"}),
                template: new sap.ui.commons.Image().bindProperty("src", "opcStats"),
                width: "75px",
                hAlign: "Center"
            }));
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "PLC STATUS"}),
                template: new sap.ui.commons.Image().bindProperty("src", "plcStats"),
                width: "75px",
                hAlign: "Center"
            }));
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "LAST MESSSAGE TYPE"}),
                template: new sap.ui.commons.TextView().bindProperty("text", "notifTransactionType"),
                sortProperty: "notifTransactionType",
                filterProperty: "notifTransactionType",
                width: "125px"
            }));
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "TIMESTAMP"}),
                template: new sap.ui.commons.TextView().bindProperty("text", "CreatedOn"),
                sortProperty: "CreatedOn",
                filterProperty: "CreatedOn",
                width: "125px"
            }));
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "MESSAGES QTY [24H]"}),
                template: new sap.ui.commons.TextView().bindProperty("text", "LAST24H"),
                sortProperty: "",
                filterProperty: "",
                width: "125px"
            }));
        }
        ;

        // ******************************************************************************************************************************************************************
        //Create an instance of the table control
        var oTable = new sap.ui.table.Table({
            visibleRowCount: nrRows,
            visibleRowCountMode: sap.ui.table.VisibleRowCountMode.Interactive,
            firstVisibleRow: 0,
            width: "1200px",
            selectionBehavior: sap.ui.table.SelectionBehavior.Row,
            selectionMode: sap.ui.table.SelectionMode.Single
        });

        // ******************************************************************************************************************************************************************
        oTable.attachRowSelectionChange(function (oEvent) {
            // Retrieve the selected row
            var selIndex = oTable.getSelectedIndex();
            selectedIndex = selIndex;
            if (selIndex >= 0) {
                // Retrieve the selected row
                var selectedRow = oTable.getRows()[selIndex];
                // sap.ui.commons.MessageBox.alert(selectedRow);
                var selectedRowContext = oEvent.getParameter("rowContext");
                recordID = oModel.getProperty("recordID", selectedRowContext);
            }
            else {
                selectedIndex = -1;
                recordID = "";
                // alert ("No Selection ..");
            }
        });

        var oModel = new sap.ui.model.xml.XMLModel();

        //Bring the table onto the UI
        oMatrixT.createRow(oTable);
        var map0, map1, map2, map3, map4, map5, map6, map7, map8, map9, map10, map3489, map510, map67;

        $.get('maps/TOLEDO.json', function (data) {
            map0 = Highcharts.geojson(data);
            mapInit(map0);
        })

        $.get('maps/ALL ASSY.json', function (data) {
            map1 = Highcharts.geojson(data);
        });
        $.get('maps/FORD CS1 ASSY.json', function (data) {
            map2 = Highcharts.geojson(data);
        });
        $.get('maps/FRONT CS ASSY.json', function (data) {
            map3 = Highcharts.geojson(data);
        });
        $.get('maps/REAR CS ASSY.json', function (data) {
            map4 = Highcharts.geojson(data);
        });
        $.get('maps/FORD CS1 ASSY.json', function (data) {
            map5 = Highcharts.geojson(data);
        });
        $.get('maps/FORD CS1 ASSY.json', function (data) {
            map6 = Highcharts.geojson(data);
        });
        $.get('maps/FORD CS1 ASSY.json', function (data) {
            map7 = Highcharts.geojson(data);
        });
        $.get('maps/REAR AXLE ASSY.json', function (data) {
            map8 = Highcharts.geojson(data);
        });
        $.get('maps/FRONT AXLE ASSY.json', function (data) {
            map9 = Highcharts.geojson(data);
        });
        $.get('maps/FORD CS1 ASSY.json', function (data) {
            map10 = Highcharts.geojson(data);
        });
        $.get('maps/JL FRONT_REAR.json', function (data) {
            map3489 = Highcharts.geojson(data);
        });
        $.get('maps/FORD P558.json', function (data) {
            map67 = Highcharts.geojson(data);
        });
        $.get('maps/JT COMBO.json', function (data) {
            map510 = Highcharts.geojson(data);
        });

        function cc(o) {
            console.log(o);
        }
        // ****************************************************************************************************************************************************
        function updatePlants(idPlant) {

            var timestamp = new Date().getTime();
            getData("/XMII/Illuminator?QueryTemplate=MESM/PLANTS/TRANSACTIONS/getActivePlants_xAcute&Param.1=" + idPlant + "&ts=" + timestamp + "&Content-Type=text/xml", parseJsonPlantsList);
            function parseJsonPlantsList(jsondata) {
                oDropdownBoxPlants.destroyItems();

                for (var i = 0; i < jsondata.length; i++) {
                    item_key = jsondata[i]['PLANT'];
                    item_text = jsondata[i]['DESC'];
                    oItem = new sap.ui.core.ListItem({
                        key: item_key,
                        text: item_text
                    });
                    oDropdownBoxPlants.addItem(oItem);
                }
                oDropdownBoxPlants.setSelectedKey(idPlant);
                // alert(oDropdownBoxPlants.getSelectedKey());
                updateTableConnDiagnostics();
            }
        }
        // ****************************************************************************************************************************************************
        function ScreenSize() {
            var a = 100;
            var w = window;
            var d = document;
            var e = d.documentElement;
            var g = d.getElementsByTagName('body')[0];
            var sx = w.innerWidth || e.clientWidth || g.clientWidth;
            var sy = w.innerHeight || e.clientHeight || g.clientHeight;
            return {
                x: sx,
                y: sy
            }
        }


        var drillUp = false;
        var mapChart = null;
        var chartAnimation = true;
        var animation_duration = 1000;
        var prTitle = [];
        function mapInit(mapData) {

//            console.log('mapData : ', mapData);
            $.each(mapData, function (i) {
                this.drilldown = this.properties['hc-key'];
                this.value = 50 + Math.round((Math.random() * 50));
            });
            var mapName = 'TOLEDO';
//            var mapTop = Highcharts.geojson(map0);
//            var mapTop;


            mapChart = new Highcharts.Map('p1', {
                chart: {
                    animation: chartAnimation,
                },
                chart: {
//                    height: ScreenSize()['y'],
                    animation: false,
                    height: 450,
                    events: {
                        redraw: function () {
//                                cc('redraw');
                        },
                        drilldown: function (e) {
                            cc(e.point);
                            var mapDrilldown = null;
                            if (mapChart.title.textStr == 'TOLEDO') {
                                if (e.point.name == 'ALL ASSY') {
                                    prTitle.push(mapChart.title.textStr);
                                    var title = {
                                        text: 'ALL ASSY',
                                    };
                                    mapChart.setTitle(title);
                                    mapDrilldown = map1;
                                } else if (e.point.name == 'FORD CS1 ASSY') {
                                    prTitle.push(mapChart.title.textStr);
                                    var title = {
                                        text: 'FORD CS1 ASSY',
                                    };
                                    mapChart.setTitle(title);
                                    mapDrilldown = map2;
                                } else if (e.point.name == 'FRONT CS ASSY' || e.point.name == 'REAR CS ASSY' || e.point.name == 'REAR AXLE ASSY' || e.point.name == 'FRONT AXLE ASSY') {
                                    prTitle.push(mapChart.title.textStr);
                                    var title = {
                                        text: 'JL FRONT_REAR',
                                    };
                                    mapChart.setTitle(title);
                                    mapDrilldown = map3489;
                                    $.each(mapDrilldown, function (i) {
                                        this.drilldown = this.properties['hc-key'];
//                                        this.value = 50 + Math.round((Math.random() * 50));
                                    });
                                } else if (e.point.name == 'FORD CS2 ASSY' || e.point.name == 'FORD AXLE ASSY') {
                                    prTitle.push(mapChart.title.textStr);
                                    var title = {
                                        text: 'FORD P555',
                                    };
                                    mapChart.setTitle(title);
                                    mapDrilldown = map67;
                                    $.each(mapDrilldown, function (i) {
                                        this.drilldown = this.properties['hc-key'];
                                        this.value = 50 + Math.round((Math.random() * 50));
                                    });
                                } else if (e.point.name == 'COMBO CS ASSY' || e.point.name == 'COMBO AXLE ASSY') {
                                    prTitle.push(mapChart.title.textStr);
                                    var title = {
                                        text: 'JT COMBO',
                                    };
                                    mapChart.setTitle(title);
                                    mapDrilldown = map510;
                                    $.each(mapDrilldown, function (i) {
                                        this.drilldown = this.properties['hc-key'];
                                        this.value = 50 + Math.round((Math.random() * 50));
                                    });
                                }
                            }
                            if (mapChart.title.textStr == 'JL FRONT_REAR') {
                                if (e.point.drilldown == 'FRONT CS ASSY') {
                                    console.log('JL FRONT_REAR ', 'FRONT CS ASSY');
                                    prTitle.push(mapChart.title.textStr);
                                    var title = {
                                        text: 'FRONT CS ASSY',
                                    };
                                    mapChart.setTitle(title);
                                    mapDrilldown = map3;
//                                    $.each(mapDrilldown, function (i) {
//                                        this.drilldown = this.properties['hc-key'];
//                                        this.value = 50 + Math.round((Math.random() * 50));
//                                    });
                                }
                            }
                            this.addSingleSeriesAsDrilldown(e.point, {
                                borderWidth: 0,
//                                name: e.point.name,
                                name: mapChart.title.textStr,
                                data: mapDrilldown,
                                dataLabels: {
                                    enabled: true,
                                    format: '{point.name}'
                                }
                            });
                            this.applyDrilldown();
                        },
                        drillup: function (e) {
                            drillUp = true;
                            var title = {
                                text: prTitle.pop(),
                            };

                            mapChart.setTitle(title);
//                            cc('drillUp = true');
                        },
                        load: function () {
                        }
                    }
                },
                lang: {
                    drillUpText: " << Back to {series.name}"
//                    drillUpText: " << Back"
                },
                exporting: {
                    enabled: false
                },
                credits: {
                    enabled: false,
                    href: 'http://www.rtsperfectplant.com/',
                    position: {
                        align: 'right',
                        x: -10,
                        verticalAlign: 'bottom',
                        y: -5
                    },

                    style: {
                        cursor: 'pointer',
                        color: '#999999',
                        fontSize: '9px'
                    },

                    text: 'RTS Consulting Inc.'
                },
                title: {
//                    text: rootNode.getText()
                    text: mapName
                },
                subtitle: {
                    text: '',
                    style: {
                        display: 'none'
                    }
                },

                legend: {
                    enabled: false,
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                },
//                xAxis: {
//                    crosshair: {
//                        zIndex: 5,
//                        dashStyle: 'dot',
//                        snap: false,
//                        color: 'gray'
//                    }
//                },
//
//                yAxis: {
//                    crosshair: {
//                        zIndex: 5,
//                        dashStyle: 'dot',
//                        snap: false,
//                        color: 'gray'
//                    }
//                },
                colorAxis: {
                    showInLegend: false,
                    min: 0,
                    minColor: '#E6E7E8',
                    maxColor: '#005645'
                },
                mapNavigation: {
                    enabled: true,
                    buttonOptions: {
                        verticalAlign: 'bottom'
                    }
                },

                plotOptions: {
                    series: {
                        events: {
                            afterAnimate: function () {
                                cc('afterAnimate');
                                if (drillUp && mapChart.title.textStr == 'TOLEDO') {
                                    drillUp = false;
                                    cc('drillUp');
                                    chartAnimation = false;
                                    animation_duration = 0;
                                    mapInit(map0);
                                } else {
                                    drillUp = false;
                                }

                            }
                        }
                    },
                    map: {
                        states: {
                            hover: {
                                color: '#EEDD66'
                            }
                        }
                    },
                    point: {
                        events: {
                            click: function () {
//                                    mapLevel1Refresh = new Date().getTime();
                            },
                            mouseOver: function () {
                                //alert('mouseOver');
//                                    mapLevel1Refresh = new Date().getTime();

                            },
                            mouseOut: function () {
                                //alert('mouseOut');
//                                    mapLevel1Refresh = new Date().getTime();
                            }
                        }
                    }
                },


//                plotOptions: {
//                    map: {
//                        states: {
//                            hover: {
//                                color: '#EEDD66'
//                            }
//                        }
//                    },
//                    series: {
//                        animation: {
//                            complete: function () {
//                                cc('complete');
//                                if (drillUp) {
//                                    drillUp = false;
//                                    console.log('drillUp');
//                                } else {
//                                    drillUp = false;
//                                }
//                            },
//                            events: {
//                                afterAnimate: function (ev) {
//                                    cc('afterAnimate');
//
//                                    console.log('fired only once for each series');
//                                }
//                            }
//                        },
//                        point: {
//                            events: {
//                                click: function () {
////                                    mapLevel1Refresh = new Date().getTime();
//                                },
//                                mouseOver: function () {
//                                    //alert('mouseOver');
////                                    mapLevel1Refresh = new Date().getTime();
//
//                                },
//                                mouseOut: function () {
//                                    //alert('mouseOut');
////                                    mapLevel1Refresh = new Date().getTime();
//
//                                }
//                            }
//                        }
//                    }
//                },
                series: [{
                    borderWidth: 0,
                    animation: {
                        duration: animation_duration
                    },
                    data: mapData,
                    name: mapName,
                    dataLabels: {
                        enabled: true,
                        align: 'center',
                        verticalAlign: 'middle',
                        format: '{point.properties.name}'
                    }
                }],
                drilldown: {
                    //series: drilldownSeries,
                    activeDataLabelStyle: {
                        color: '#FFFFFF',
                        textDecoration: 'none',
                        textShadow: '0 0 0px #000000'
                    },
                    drillUpButton: {
                        relativeTo: 'spacingBox',
                        position: {
                            x: 0,
                            y: 60
                        }
                    }
                }
            });
            chartAnimation = true;
            animation_duration = 1000;
        }

    </script>
</head>

<body onLoad="roleSecurity()">

<input id="user_roles" type="hidden" value="{IllumLoginRoles}" style="display:block;width:1000px;" readonly/>
<input id="user_role" type="hidden" value="{ROLE}" style="display:block;width:1000px;" readonly/>
<input id="user_name" type="hidden" value="{IllumLoginName}" style="display: block;width:1000px;" readonly/>
<input id="user_height" type="hidden" value="{HEIGHT}" style="display: block;width:100px;" readonly/>
<input id="user_address" type="hidden" value="{Machine}" style="display:block;width:1000px;" readonly/>
<div id="app_header">
    <div id="app_title">CORE TRACEABILITY</div>
    <div id="app_menu"></div>
    <div id="page_title">DIAGNOSTICS</div>
</div>
<div id="p1"></div>
<div id="mesm_content"></div>
</body>
</html>