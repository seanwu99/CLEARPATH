<!DOCTYPE html>
<html lang="en" ng-app="kitchensink">
<head>
    <meta charset="utf-8">
    <script src="lib/fabric.js"></script>
    <title>Intersection | Fabric.js Demos</title>

    <script id="sap-ui-bootstrap"
            src="https://sapui5.netweaver.ondemand.com/resources/sap-ui-core.js"
            data-sap-ui-theme="sap_bluecrystal"
            data-sap-ui-libs="sap.m,sap.ui.commons,sap.ui.table,sap.ui.core"
            data-sap-ui-language="en">

    </script>

    <script>
        $(function () {

            /*
             TODO:
             - Check data labels after drilling. Label rank? New positions?
             - Not US Mainland text
             - Separators
             */

            var data = Highcharts.geojson(Highcharts.maps['maps']),
                    // Some responsiveness
                    small = $('#container').width() < 400;

            // Set drilldown pointers
            $.each(data, function (i) {
                this.drilldown = this.properties['hc-key'];
                this.value = 60 + Math.round((Math.random() * 40)); // Non-random bogus data
            });

            // Instanciate the map
            Highcharts.mapChart('container', {
                chart: {
                    events: {
                        drilldown: function (e) {

                            if (!e.seriesOptions) {
                                var chart = this,
                                        mapKey = 'countries/us/' + e.point.drilldown + '-all',
                                        // Handle error, the timeout is cleared on success
                                        fail = setTimeout(function () {
                                            if (!Highcharts.maps[mapKey]) {
                                                chart.showLoading('<i class="icon-frown"></i> Failed loading ' + e.point.name);

                                                fail = setTimeout(function () {
                                                    chart.hideLoading();
                                                }, 1000);
                                            }
                                        }, 3000);

                                // Show the spinner
                                chart.showLoading('<i class="icon-spinner icon-spin icon-3x"></i>'); // Font Awesome spinner

                                // Load the drilldown map
                                $.getScript('https://code.highcharts.com/mapdata/' + mapKey + '.js', function () {

                                    data = Highcharts.geojson(Highcharts.maps[mapKey]);


                                    $.each(data, function (i) {
                                        this.value = 60 + Math.round((Math.random() * 40));
                                    });

                                    // Hide loading and add series
                                    chart.hideLoading();
                                    clearTimeout(fail);
                                    chart.addSeriesAsDrilldown(e.point, {
                                        name: e.point.name,
                                        data: data,
                                        dataLabels: {
                                            enabled: true,
                                            format: '{point.name}'
                                        }
                                    });
                                });
                            }


                            this.setTitle(null, {text: e.point.name});
                        },
                        drillup: function () {
//                            this.setTitle(null, {text: 'USA'});
                        }
                    }
                },

                title: {
                    text: 'maps'
                },

//                subtitle: {
//                    text: 'USA',
//                    floating: true,
//                    align: 'right',
//                    y: 50,
//                    style: {
//                        fontSize: '16px'
//                    }
//                },

//                legend: small ? {} : {
//                    layout: 'vertical',
//                    align: 'right',
//                    verticalAlign: 'middle'
//                },

                colorAxis: {
                    showInLegend: false,
                    min: 0,
                    minColor: '#E6E7E8',
                    maxColor: '#005645'
                },

                mapNavigation: {
                    enabled: true,
                    buttonOptions: {
                        verticalAlign: 'top'
                    }
                },

                plotOptions: {
                    map: {
                        states: {
                            hover: {
                                color: '#EEDD66'
                            }
                        }
                    }
                },

                series: [{
                    data: data,
                    name: 'maps',
                    dataLabels: {
                        enabled: true,
                        format: '{point.properties.postal-code}'
                    }
                }],

                drilldown: {
                    //series: drilldownSeries,
                    activeDataLabelStyle: {
                        color: '#FFFFFF',
                        textDecoration: 'none',
                        textShadow: '0 0 3px #000000'
                    },
                    drillUpButton: {
                        relativeTo: 'spacingBox',
                        position: {
                            x: 0,
                            y: 60
                        }
                    }
                }
            });
        });
    </script>
</head>
<body>
<button id="test1">1</button>
<button id="test2">2</button>
<button id="test3">3</button>
<canvas id="c" width="1100" height="800" style="border: 1px solid #aaa"></canvas>

<script id="main">
    // 		(function() {
    var canvas = new fabric.Canvas('c');
    canvas.setBackgroundImage("floor.png");

    var rect0 = new fabric.Rect({
        width: 200,
        height: 200,
        left: 0,
        top: 50,
        angle: 30,
        fill: 'rgba(255,0,0,0.5)'
    });
    var rect1 = new fabric.Rect({
        width: 200,
        height: 100,
        left: 0,
        top: 50,
        angle: 30,
        fill: 'rgba(255,0,0,0.5)'
    });

    var rect2 = new fabric.Rect({
        width: 100,
        height: 100,
        left: 350,
        top: 250,
        angle: -10,
        fill: 'rgba(0,200,0,0.5)'
    });

    var rect3 = new fabric.Rect({
        width: 50,
        height: 100,
        left: 275,
        top: 350,
        angle: 45,
//			stroke : '#eee',
//			strokeWidth : 10,
        fill: 'rgba(0,0,200,0.5)'
    });

    var circle = new fabric.Circle({
        radius: 50,
        left: 275,
        top: 75,
        fill: '#aac'
    });

    var triangle = new fabric.Triangle({
        width: 100,
        height: 100,
        left: 50,
        top: 300,
        fill: '#cca'
    });

    canvas.add(rect1, rect2, rect3, circle, triangle);
    cc(fabric);


    $('#test1').click(function () {
        canvas.add(rect0);
    });

    $('#test2').click(function () {
        lineChartTest();
    });
    $('#test3').click(function () {
        BarChart.series[0].remove();
    });
    function ss(_string) {
        alert(_string);
    }
    function cc(_object) {
        console.log(_object);
    }
    // 		})();
</script>
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="https://code.highcharts.com/maps/modules/data.js"></script>
<script src="https://code.highcharts.com/maps/modules/drilldown.js"></script>
<script src="maps.js"></script>

<div id="container" style="height: 500px; width: 1100px;"></div>
</body>
</html>
